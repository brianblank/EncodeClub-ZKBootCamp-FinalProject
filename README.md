# EncodeClub-ZKBootCamp-FinalProject

## Description

This project uses the Semaphore API ( https://docs.semaphore.pse.dev/ ) to support ZK Voting.  This voting app simulates the 2024 Presendential Election in the US, supporting 2 candidates (Donald Trump & Joe Biden).

The code performs the following steps:

1. Generates 3 random Identities.
	a. Private Key is input to Identity() so that the identity can be generated deterministicly.  Note that this example application uses private keys that are very small in size and therefore is not secure.  It would be required to use a secure number random number generator to generate a very large private key.
	b. Public Key leveraging Elliptic Curve algorithm from the Private Key and Generator.
	c. Commitment String - This is simply a hash of the Public Key.  Note that the commitment string is used to register the voter to a Merkle Tree of registered voters.

2. Register each of the voters by inserting the commitment strings into the leaf nodes of a Merkle Tree.

3. After the 3 identities are added to a Merkle Tree, I print the Merkle Proofs for each of the 3 identities.  This step is not necessary, but it does expose the Merkle Root which can be used throughout to help debug/validate the output.

4. For each identity, we randomly pick a candidate and generate a ZK Proof which proves the following:
	a. The voter is registered (the commitment string is in the Merkle Tree)
	b. The voter's private key can be used to derive the public key and commitment strings.
	c. The voter casted a vote for a specific candidate.  The public key is used to verify the signature of the vote (aka message)
	d. A nullifier correctly is produced as a hash of the private key and scope (aka 2024 Presidential Election)

5. The output of the generate proof generates the following data:
	a. MerkleTreeDepth is 2 for our small tree of 3 registered voters.
	b. MerkleTreeRoot is the root of the registered voters merkle tree.
	c. nullifier -- This needs to be leveraged by the smart contract to prevent double voting, verified in the ZKP, but managed in a map in the smart contract.
	d. message -- this is an encoded number of the vote 
		Joe Biden: '33667968765445399671216087522018318585790620385181707500062978815284582809600'
		Donald Trump: '30954155546480405811836154381571360669377769058458888585493690350859129454592'
	e. Scope -- this is an encoded number of the election id "2024 Presidential Election"
	f. points -- this is the ZK Proof (generated from groth16)

To use this data online, you can leverage the following contract as an example:
	https://github.com/semaphore-protocol/semaphore/blob/main/packages/contracts/contracts/Semaphore.sol
Then:
1. First run createGroup which returns groupID of 0.  This group will be used for the 2024 Presidential Election.  Other groups can be created for different elections.
2. Call addMember for each identity that you want to register to vote in election, passing the groupID output from step 1, and the commitment string from the identity.
3. Finally, after the elections are made in the Javascript code, run the validateProof method, passing the groupID generated in step 1, and the generated Proof.  The proof you can pass for the example shown below for the first identity is as follows:
```
[
  2,
  12389682026515143987921962250392990718749480141269816392040135921126665273121,
  8516044558594399788989450073051130659970127307669584041444983773759152683513,
  30954155546480405811836154381571360669377769058458888585493690350859129454592,
  22700797580910335338803308604009894655989814618905011909044492845535115345920,
  [
    2745017345572219184865819136236674482010529149242731146778999792742820589466,
    13817038996388961029653635806902892798143444077608408054985943315776695388137,
    18445289203083865232018644619817557964493980609067970755202908460738629860820,
    18890333323893537452442652118411055294014178513748779236884823752604703596301,
    3471914469483979465888537819095516699452273656200013814997441031534626714916,
    13265943345419464228188261671399248007090339554267217666988344894420181992416,
    11037607297523972818044711049092357397457995136863261018910055059983713311367,
    1774338582070372003840032871409421841544872311631010646848843444252223203350
  ]
]
```


## Prerequisites
1. nodejs

## Download and Install
```
git clone https://github.com/brianblank/EncodeClub-ZKBootCamp-FinalProject.git
cd EncodeClub-ZKBootCamp-FinalProject
npm install @semaphore-protocol/identity
npm install @semaphore-protocol/group
npm install @semaphore-protocol/proof
```

## Run
```
node src/js/vote.js
```

## Example Execution
```
(base) brian@DESKTOP-JOU6V0Q:~/dev/zkbootcamp-finalproject/EncodeClub-ZKBootCamp-FinalProject$ node src/js/vote.js
Identities:
Identity {
  _privateKey: 'secret-value0',
  _secretScalar: 1148627883466279213350788191944364675114759973900437497428349203256547101813n,
  _publicKey: [
    7942970043080236690143637268671048752578599728696140703129758266295574468178n,
    1497446118932168230438557739827182656908185264105093667314540030229762920390n
  ],
  _commitment: 17934147708612671165970341019286811203568903068722730967247298881379801261300n
}

Identity {
  _privateKey: 'secret-value1',
  _secretScalar: 304670167289643880087911603053652658832028651550725938702572450767757945986n,
  _publicKey: [
    13042725054120862782470532701483051306195467155689840732545956783185686862148n,
    15558919835094491184464462783676969326605276760366957502732414417761002657331n
  ],
  _commitment: 4897931742739380466742730225369956393418519751587825836655815417835016787187n
}

Identity {
  _privateKey: 'secret-value2',
  _secretScalar: 1504657219246606432913773006319723355336958218698420516113215068265151559294n,
  _publicKey: [
    13689247466759613997408276626848038906121617731117980306088871869514514983762n,
    5188400444047553938490706409270136668916881703608372009955128757623928691252n
  ],
  _commitment: 4211873115554056095376502950133306693321154978512320132138419056346371296452n
}





Proof for identity 0:
{
  root: 12389682026515143987921962250392990718749480141269816392040135921126665273121n,
  leaf: 17934147708612671165970341019286811203568903068722730967247298881379801261300n,
  index: 0,
  siblings: [
    4897931742739380466742730225369956393418519751587825836655815417835016787187n,
    4211873115554056095376502950133306693321154978512320132138419056346371296452n
  ]
}

Proof for identity 1:
{
  root: 12389682026515143987921962250392990718749480141269816392040135921126665273121n,
  leaf: 4897931742739380466742730225369956393418519751587825836655815417835016787187n,
  index: 1,
  siblings: [
    17934147708612671165970341019286811203568903068722730967247298881379801261300n,
    4211873115554056095376502950133306693321154978512320132138419056346371296452n
  ]
}

Proof for identity 2:
{
  root: 12389682026515143987921962250392990718749480141269816392040135921126665273121n,
  leaf: 4211873115554056095376502950133306693321154978512320132138419056346371296452n,
  index: 1,
  siblings: [
    1737669960432004435230362314752096085499304678509462124614111824121074204787n
  ]
}

Vote Proofs:
Proof for identity 0:
Vote: Donald Trump
{
  merkleTreeDepth: 2,
  merkleTreeRoot: '12389682026515143987921962250392990718749480141269816392040135921126665273121',
  nullifier: '8516044558594399788989450073051130659970127307669584041444983773759152683513',
  message: '30954155546480405811836154381571360669377769058458888585493690350859129454592',
  scope: '22700797580910335338803308604009894655989814618905011909044492845535115345920',
  points: [
    '2745017345572219184865819136236674482010529149242731146778999792742820589466',
    '13817038996388961029653635806902892798143444077608408054985943315776695388137',
    '18445289203083865232018644619817557964493980609067970755202908460738629860820',
    '18890333323893537452442652118411055294014178513748779236884823752604703596301',
    '3471914469483979465888537819095516699452273656200013814997441031534626714916',
    '13265943345419464228188261671399248007090339554267217666988344894420181992416',
    '11037607297523972818044711049092357397457995136863261018910055059983713311367',
    '1774338582070372003840032871409421841544872311631010646848843444252223203350'
  ]
}
Proof is valid: true

Proof for identity 1:
Vote: Donald Trump
{
  merkleTreeDepth: 2,
  merkleTreeRoot: '12389682026515143987921962250392990718749480141269816392040135921126665273121',
  nullifier: '12183511472660772267675133570249778951170511808287971683061478048028653456855',
  message: '30954155546480405811836154381571360669377769058458888585493690350859129454592',
  scope: '22700797580910335338803308604009894655989814618905011909044492845535115345920',
  points: [
    '7531893503560297869745400662561904245455734968133434010687380140576278708064',
    '11075208761198241429273662564563587056317141731059497324309128026234047550972',
    '7638550038664295488119312670002421480362280618642945419989559476229020949686',
    '1856001988814242219052259587952184496424798550796820173708558517487129486861',
    '8196965254589397033943258119386671561646001872584289525643126354693819176431',
    '6792616976589842764585678030003704377333544433136648071244217196156107950627',
    '10609355705498198328111823828155830984440275019933526367168039307999803533654',
    '5357014542081725909152149780381168983987958313478594223742427999451260763038'
  ]
}
Proof is valid: true

Proof for identity 2:
Vote: Joe Biden
{
  merkleTreeDepth: 1,
  merkleTreeRoot: '12389682026515143987921962250392990718749480141269816392040135921126665273121',
  nullifier: '15452208804718047146565319327699528717077052023952817808259447051584557730755',
  message: '33667968765445399671216087522018318585790620385181707500062978815284582809600',
  scope: '22700797580910335338803308604009894655989814618905011909044492845535115345920',
  points: [
    '12889670745011693263275104618906795814962628318417369800453828209035108352160',
    '17301333137499018437766665857250086418609236047930367620018163698782606950986',
    '9391839406220118120586657472593447137667622784078162621296457166366347467393',
    '5876260267499313129453609610429128346657239610524349298651009528581962878864',
    '2843830778736539372412311281958818789083061249831990206198061163497849102992',
    '6186293599752947794440855626746208634018163936920193157439072233432154010119',
    '4663277390476675708065611064180511891296336721193113053660184306903834580020',
    '13343444590930064943790023441899737162776995971506933490752615653852844922331'
  ]
}
Proof is valid: true
```
